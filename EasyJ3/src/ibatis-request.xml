<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap SYSTEM  "http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="request" >
	<resultMap class="elicitation.model.request.Request" id="Map.Request">
		<result property="description" column="req_description" javaType="java.lang.String" jdbcType="char" nullValue=" "/>
		<result property="projectId" column="project_id" javaType="int" jdbcType = "int" nullValue="-1"/>
		<result property="roleId" column ="role_id" javaType = "int" jdbcType="int" nullValue="-1"/>
		<result property="userId" column = "user_id" javaType="int" jdbcType = "int" nullValue="-1"/>
		<result property="requestId" column="id" javaType="int" jdbcType="int" nullValue="-1"/>
	</resultMap>
	<select id="selectProjectRequests" parameterClass="elicitation.model.project.Project"
		resultMap="Map.Request">
			select * from req_join_scenario join project on 
				req_join_scenario.project_id = project.project_id
				where project.project_id = #projectId# and req_join_scenario.status = 'wait'
	</select>
	<update id="approveRequest" parameterClass="elicitation.model.request.Request">
		update req_join_scenario set status = 'approve' where id = #requestId#
	</update>
	<insert id="insertUserProjectRole" parameterClass="elicitation.model.request.Request">
		insert into user_project_role ( user_id ,project_id,role_id ) 
		select user_id,project_id,role_id
		from req_join_scenario 
		where req_join_scenario.id = #requestId#
		<selectKey keyProperty="id">select @@IDENTITY as id</selectKey>
	</insert>
	<update id="rejectRequest" parameterClass="elicitation.model.request.Request">
		update req_join_scenario set status = 'reject' where id = #requestId#
	</update>
	<delete id="deleteUserProjectRole" parameterClass="elicitation.model.request.Request">
		delete from user_project_role where user_id = #userId# and role_id = #roleId#
	</delete>
</sqlMap>	